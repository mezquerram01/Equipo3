#!/bin/bash
# Crear la clave y guardarla en un archivo
aws ec2 create-key-pair --key-name mensagl-2024 --query 'KeyMaterial' --output text > mensagl-2024.pem

# Asignar el nombre de la clave a una variable
clave="mensagl-2024"

# Lanzar una instancia EC2 utilizando la VPC 
ec2_nginx=$(aws ec2 run-instances --image-id ami-0c7217cdde317cfec --instance-type t2.micro --key-name $clave --subnet-id $subnet_public1_id --associate-public-ip-address --user-data file://./userdata_script.sh --tag-specifications 'ResourceType=instance,Tags=[{Key=Name,Value=nginx3}]' --output json)



# Obtener la ID del grupo de seguridad "nginx"
nginx_security_group_id=$(aws ec2 describe-security-groups --filters "Name=tag:Name,Values=nginx" --query 'SecurityGroups[0].GroupId' --output json | jq -r '.')
echo $nginx_security_group_id

instance_id=$(echo $ec2_nginx | jq -r '.Instances[0].InstanceId')

aws ec2 modify-instance-attribute --instance-id $instance_id --groups $nginx_security_group_id
